system: |
  Vous êtes un assistant spécialisé dans l'extraction d'informations immobilières à partir de texte et notamment d'annonces immobilières.
  Vous devez extraire les informations pertinentes et les structurer en JSON selon le format demandé.
  Si une information n'est pas présente dans le texte, utilisez null.
  Pour les champs de type booléen, utilisez false si l'information n'est pas mentionnée.

prompts:
  update_property: |
    Voici les détails actuels du bien immobilier :
    {existing_property}

    Voici de nouvelles informations sur ce bien :
    {user_input}

    Veuillez extraire les informations pertinentes et mettre à jour les détails du bien.
    IMPORTANT : 
    - Conservez TOUTES les informations existantes si elles ne sont pas explicitement modifiées par le nouveau texte
    - Pour le quartier, conservez le prix_moyen existant et ajoutez les nouvelles transactions à la liste existante
    - Ne remettez PAS à null les champs existants s'ils ne sont pas mentionnés dans les nouvelles informations

  new_property: |
    Voici les informations sur un nouveau bien immobilier :
    {user_input}

    Veuillez extraire les informations pertinentes pour créer une nouvelle fiche de bien.

response_format:
  type: "json_schema"
  json_schema:
    name: "property_response"
    schema:
      type: "object"
      properties:
        property:
          type: "object"
          properties:
            # Identifiants
            id:
              type: "string"
              description: "Identifiant unique du bien"
            adresse:
              type: "string"
              description: "Adresse complète du bien"
            
            # Caractéristiques physiques
            bien:
              type: "object"
              properties:
                surface:
                  type: "number"
                  description: "Surface en m²"
                etage:
                  type: "string"
                  description: "Étage du bien"
                nb_pieces:
                  type: ["integer", "null"]
                  description: "Nombre de pièces (1 pour studio/T1, 2 pour T2/F2, etc.)"
                exposition:
                  type: ["string", "null"]
                  description: "Exposition du bien (Nord, Sud, etc.)"
                dpe:
                  type: ["string", "null"]
                  description: "Classe énergétique DPE"
                ges:
                  type: ["string", "null"]
                  description: "Classe GES"
                cave:
                  type: "boolean"
                  default: false
                  description: "Présence d'une cave"
                etat:
                  type: ["string", "null"]
                  description: "État général du bien"
                travaux:
                  type: ["string", "null"]
                  description: "Description des travaux"
                type_chauffage:
                  type: ["string", "null"]
                  description: "Type de chauffage"
              required: ["surface"]
              additionalProperties: false
            
            # Prix et charges
            prix:
              type: "object"
              properties:
                annonce:
                  type: "number"
                  description: "Prix annoncé"
                hors_honoraires:
                  type: ["number", "null"]
                  description: "Prix hors honoraires"
                frais_agence_acquereur:
                  type: "boolean"
                  default: false
                  description: "Frais d'agence à la charge de l'acquéreur"
                m2:
                  type: "number"
                  description: "Prix au m² (calculé)"
              required: ["annonce"]
              additionalProperties: false
            
            charges:
              type: "object"
              properties:
                mensuelles:
                  type: ["number", "null"]
                  description: "Charges mensuelles en euros"
                taxe_fonciere:
                  type: ["number", "null"]
                  description: "Taxe foncière annuelle"
                energie:
                  type: ["number", "null"]
                  description: "Coût mensuel de l'énergie"
                chauffage:
                  type: ["string", "null"]
                  description: "Type de chauffage"
              required: []
              additionalProperties: false
            
            # Transports
            metros:
              type: "array"
              default: []
              items:
                type: "object"
                properties:
                  ligne:
                    type: "string"
                    description: "Numéro de la ligne de métro"
                  station:
                    type: "string"
                    description: "Nom de la station"
                  distance:
                    type: "integer"
                    description: "Distance en mètres"
                required: ["ligne", "station"]
                additionalProperties: false
            
            # Points forts et vigilance
            atouts:
              type: "array"
              items:
                type: "string"
              description: "Liste des points forts du bien"
              default: []
            vigilance:
              type: "array"
              items:
                type: "string"
              description: "Liste des points de vigilance"
              default: []
            commentaires:
              type: "array"
              items:
                type: "string"
              description: "Liste des commentaires additionnels qui ne concernent pas les points forts ou de vigilance"
              default: []
            
            # Quartier
            quartier:
              type: "object"
              properties:
                prix_moyen:
                  type: ["number", "null"]
                  description: "prix moyen par m2 à l'adresse - CONSERVER LA VALEUR EXISTANTE"
                transactions:
                  type: "array"
                  items:
                    type: "string"
                  description: "transactions récentes à l'adresse sous forme de texte avec uniquement l'année, surface et prix (ex: '2021: 43m2 à 395,000€')"
                commentaires:
                  type: ["string", "null"]
                  description: "commentaires sur le quartier"
              required: []
              additionalProperties: false
              
            # Lien
            lien_annonce:
              type: ["string", "null"]
              description: "Lien vers l'annonce immobilière"
              
          required: []
          additionalProperties: false
        
        error:
          type: ["string", "null"]
          description: "Message d'erreur si l'extraction a échoué"
          
      required: ["property"]
      additionalProperties: false 